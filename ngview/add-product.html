<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Đăng sản phẩm</title>
    <link rel="stylesheet" href="">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="/css/styles.css" />

</head>
<style>
    .main-tilte {
        display: flex;
        justify-content: center;
        color: #ff3f40;
        font-size: x-large;
        font-weight: bold;
    }

    .title-div {
        font-size: medium;
        font-weight: bold;
    }

    .title-element {
        margin: 20px;
        font-size: small;
    }

    .add-color {
        border: 1px dashed black;
        margin-top: 5px;
    }

    .color-detail {
        border: 1px solid black;
        margin-top: 5px;
    }

    .color-detail .add-color :hover {
        background-color: #ff3f3f48;
    }
</style>

<body ng-controller="AddProductsController">
    <div class="row">
        <!--Tabs-->
        <div>
            <!-- Danh sách mua hàng -->
            <div class="tab-content">
                <div style="margin-bottom: 5.5rem;">
                    <form method="post" enctype="multipart/form-data" ng-submit="addProduct()">
                        <div class="ml-auto" style="margin-right: 100px;">
                            <div class="basic-infomation-product card">
                                <div class="card-header main-tilte">Thêm sản phẩm</div>
                                <div class="card-body row">
                                    <div class="title-div">Thông tin sản phẩm</div>
                                    <div class="col-2">
                                        <div class="title-element">Tên sản phẩm</div>
                                    </div>
                                    <div class="col-9 mt-3">
                                        <div class="form-group form-group-alt ">
                                            <input ng-model="product.productName" type="text" class="form-control input"
                                                required>
                                        </div>
                                    </div>
                                    <div class="col-2">
                                        <div class="title-element">Chất liệu</div>
                                    </div>
                                    <div class="col-9 mt-3">
                                        <div class="form-group form-group-alt ">
                                            <input ng-model="product.material" required type="text"
                                                class="form-control input">
                                        </div>
                                    </div>
                                    <div class="col-2">
                                        <div class="title-element">Mô tả</div>
                                    </div>
                                    <div class="col-9 mt-3">
                                        <div class="form-group">
                                            <textarea ng-model="product.description" name="description" id="description"
                                                class="form-control" style="height: 200px;" required></textarea>
                                        </div>
                                    </div>
                                    <div class="col-2">
                                        <div class="title-element">Hình ảnh/Video sản phẩm</div>
                                    </div>
                                    <div class="col-9 mt-3">
                                        <div id="dropArea" ondrop="dropHandler(event);"
                                            ondragover="dragOverHandler(event);" ondragleave="dragLeaveHandler(event);">
                                            <i class="fa-light fa-download" style="font-size: 4rem;"></i>
                                        </div>
                                        <div class="input-group mb-3">
                                            <label class="input-group-text" for="inputGroupFile01"> <i
                                                    class="fa-regular fa-image"></i>{{ 'HAVD' | translate }}
                                            </label> <input type="file" class="form-control" name="mediaFiles"
                                                id="inputGroupFile01" multiple required>
                                        </div>
                                        <div id="mediaList"></div>
                                    </div>
                                    <hr>
                                    <div class="title-div">Chi tiết</div>
                                    <div class="col-2">
                                        <div class="title-element">Giá gốc</div>
                                    </div>
                                    <div class="col-4 mt-3">
                                        <input type="number" class="form-control" placeholder=""
                                            ng-model="product.originalPrice" required>
                                        <small id="helpId" class="form-text text-muted">{{ product.originalPrice |
                                            currencyFormat }}</small>
                                    </div>
                                    <div class="col-2">
                                        <div class="title-element">Giảm giá (%)</div>
                                    </div>
                                    <div class="col-3 mt-3">
                                        <input type="number" class="form-control" placeholder=""
                                            ng-model="product.promotion" required>
                                    </div>

                                    <div class="col-2">
                                        <div class="title-element">Danh sách màu</div>
                                    </div>
                                    <div class="col-9 mt-3 d-flex justify-content-between">
                                        <span ng-repeat="color in colors">
                                            <label>
                                                <input type="checkbox" ng-model="color.selected"
                                                    ng-checked="isColorSelected(color.colorId)"
                                                    ng-click="toggleColorSelection(color.colorId)">
                                                {{color.colorName }}
                                            </label>
                                        </span>
                                    </div>

                                    <div class="col-2">
                                        <div class="title-element"></div>
                                    </div>
                                    <div class="col-9 mt-3">
                                        <table class="table">
                                            <thead>
                                                <tr>
                                                    <th scope="col">Màu</th>
                                                    <th scope="col">Số lượng</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr ng-repeat="selectedColor in selectedColors">
                                                    <td>{{ selectedColor }}</td>
                                                    <td><input type="text" ng-model="selectedColor.quantity"
                                                            class="form-control" required></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>

                                    <hr>
                                    <div class="title-div">Vận chuyển</div>
                                    <div class="col-2">
                                        <div class="title-element">Cân nặng</div>
                                    </div>
                                    <div class="col-9 mt-3">
                                        <input type="number" class="form-control" placeholder=""
                                            ng-model="product.weight" required>
                                    </div>
                                    <div class="col-2">
                                        <div class="title-element">Kích thước</div>
                                    </div>
                                    <div class="col-9 mt-3">
                                        <div class="input-group mb-3">
                                            <div class="col-2" style="margin: 10px;">
                                                <span class="input-group-text" id="Width">Chiều rộng</span>
                                                <input type="number" class="form-control" placeholder="Width"
                                                    aria-describedby="Width" ng-model="product.width" required>
                                            </div>
                                            <div class="col-2" style="margin: 10px;">
                                                <span class="input-group-text" id="Height">Chiều dài</span>
                                                <input type="number" class="form-control" placeholder="Height"
                                                    aria-describedby="Height" ng-model="product.height" required>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class=" justify-content-center" style="background-color: transparent; border-radius: 100px; 
                                     position: fixed; bottom: 0;">
                            <button ng-click="sendMedia()" class="btn btn-light m-1">Thêm ảnh</button>
                            <button ng-click="saveProductColor()" class="btn btn-light m-1">Thêm màu</button>
                            <button type="submit" class="btn btn-danger m-1">Thêm &
                                Hiển thị</button>

                        </div>
                    </form>
                </div>
            </div>
        </div>

    </div>

    <script>
        var selectedMedia = []; // Mảng để lưu trữ các tệp đã chọn từ cả hai lần chọn hình ảnh

        document.getElementById('dropArea').addEventListener('click',
            function () {
                document.getElementById('inputGroupFile01').click();
            });

        document.getElementById('inputGroupFile01').addEventListener('change',
            function () {
                handleFiles(this.files);
            });

        function dropHandler(event) {
            event.preventDefault();
            var files = event.dataTransfer.files;
            handleFiles(files);
        }

        function handleFiles(files) {
            var mediaType = /^image\//;
            var videoType = /^video\//;
            var mediaList = document.getElementById('mediaList');

            for (var i = 0; i < files.length; i++) {
                var file = files[i];
                if (mediaType.test(file.type) || videoType.test(file.type)) {
                    var reader = new FileReader();
                    reader.onload = (function (file) {
                        return function () {
                            if (mediaType.test(file.type)) {
                                var media = new Image();
                                media.src = this.result;
                                media.classList.add('previewMedia');
                                var container = createMediaContainer(media,
                                    file);
                                mediaList.appendChild(container);
                            } else if (videoType.test(file.type)) {
                                var media = document.createElement('video');
                                media.src = this.result;
                                media.setAttribute('controls', 'controls');
                                media.classList.add('previewMedia');
                                var container = createMediaContainer(media,
                                    file);
                                mediaList.appendChild(container);
                            }
                        };
                    })(file);
                    reader.readAsDataURL(file);
                    selectedMedia.push(file);
                }
            }

            // Cập nhật lại những ảnh hoặc video đã chọn trong phần tử <input>
            var dataTransfer = new DataTransfer();
            for (var i = 0; i < selectedMedia.length; i++) {
                dataTransfer.items.add(selectedMedia[i]);
            }
            document.getElementById('inputGroupFile01').files = dataTransfer.files;
        }

        function createMediaContainer(media, file) {
            var container = document.createElement('div');
            container.classList.add('previewMediaContainer');
            container.appendChild(media);

            var deleteButton = document.createElement('button');
            deleteButton.innerHTML = 'X';
            deleteButton.classList.add('deleteButton');
            deleteButton
                .addEventListener(
                    'click',
                    function () {
                        // Xóa hình ảnh khỏi giao diện và khỏi mảng selectedMedia khi người dùng xóa
                        var index = selectedMedia.indexOf(file);
                        if (index !== -1) {
                            selectedMedia.splice(index, 1);
                        }
                        // Cập nhật lại những ảnh hoặc video đã chọn trong phần tử <input>
                        var dataTransfer = new DataTransfer();
                        for (var i = 0; i < selectedMedia.length; i++) {
                            dataTransfer.items.add(selectedMedia[i]);
                        }
                        document.getElementById('inputGroupFile01').files = dataTransfer.files;

                        container.remove();
                    });

            container.appendChild(deleteButton);

            return container;
        }

        function dragOverHandler(event) {
            event.preventDefault();
            event.target.classList.add('active');
        }

        function dragLeaveHandler(event) {
            event.preventDefault();
            event.target.classList.remove('active');
        }
        function toggleColor(link) {
            var allLinks = document.getElementsByClassName("colorful-link");

            for (var i = 0; i < allLinks.length; i++) {
                var currentLink = allLinks[i];
                currentLink.classList.remove("active"); // Loại bỏ lớp 'active' từ tất cả các thẻ

                if (currentLink === link) {
                    link.classList.add("active"); // Thêm lớp 'active' vào thẻ được bấm
                }
            }
        }
    </script>
</body>

</html>